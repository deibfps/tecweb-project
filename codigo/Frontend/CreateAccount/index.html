<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crear Cuenta - Plantasia</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <h1 class="logo">Plantasia</h1>
    </header>
    <main>
        <section class="create-account">
            <div class="form-container">
                <h2>CREAR CUENTA</h2>
                <p>√önete a ser parte del <strong>cambio</strong></p>
                <form id="createAccountForm" action="#" method="POST">
                    <div class="input-group">
                        <label for="accountType">Tipo de cuenta</label>
                        <select id="accountType" name="accountType" required>
                            <option value="usuario" selected>Usuario</option>
                            <option value="admin">Administrador</option>
                        </select>
                    </div>

                    <div class="input-group">
                        <input type="email" id="email" name="email" placeholder=" " required>
                        <label for="email">Correo electr√≥nico</label>
                    </div>

                    <div class="input-group" style="position: relative;">
                        <input type="password" id="password" name="password" placeholder=" " required>
                        <label for="password">Contrase√±a</label>
                        <button type="button" id="togglePassword" style="position:absolute; right:10px; top:50%; transform:translateY(-50%); background:none; border:none; cursor:pointer;">
                            üëÅÔ∏è
                        </button>
                    </div>

                    <div class="input-group" id="adminKeyGroup" style="display: none;">
                        <input type="password" id="adminKey" name="adminKey" placeholder=" " autocomplete="off">
                        <label for="adminKey">Clave de administrador</label>
                    </div>

                    <button type="submit" class="btn-create">Crear cuenta</button>
                </form>
                <p class="register-link">¬øYa tienes cuenta? <a href="../Login/index.html">Ingresa aqu√≠</a></p>
            </div>
        </section>
    </main>
    <script>
document.getElementById('accountType').addEventListener('change', function() {
    const adminKeyGroup = document.getElementById('adminKeyGroup');
    if (this.value === 'admin') {
        adminKeyGroup.style.display = 'block';
        document.getElementById('adminKey').required = true;
    } else {
        adminKeyGroup.style.display = 'none';
        document.getElementById('adminKey').required = false;
    }
});

document.getElementById('createAccountForm').addEventListener('submit', function(e) {
    e.preventDefault();

    const email = document.getElementById('email').value.trim();
    const password = document.getElementById('password').value;
    const accountType = document.getElementById('accountType').value;
    const adminKey = document.getElementById('adminKey').value;

    if (accountType === 'admin' && adminKey !== 'ADMIN33') {
        alert('Clave de administrador incorrecta');
        return;
    }

    fetch('http://localhost:8080/api/signup', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
            email,
            password,
            rol: accountType
        })
    })
    .then(res => res.json())
    .then(data => {
        if (data.success) {
            alert('Cuenta creada exitosamente');
            window.location.href = '../Login/index.html';
        } else {
            alert(data.message || 'Error al crear la cuenta');
        }
    })
    .catch(() => alert('Error de conexi√≥n con el servidor'));
});

document.getElementById('togglePassword').addEventListener('click', function () {
    const passwordInput = document.getElementById('password');
    const type = passwordInput.type === 'password' ? 'text' : 'password';
    passwordInput.type = type;
    this.textContent = type === 'password' ? 'üëÅÔ∏è' : 'üôà';
});
</script>
</body>
</html>
