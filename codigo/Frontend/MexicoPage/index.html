<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>México y el Cuidado Ambiental - Plantasia</title>
  <link rel="stylesheet" href="style.css?v=2" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
<script>
if (!localStorage.getItem('usuarioLogueado')) {
    alert("Inicia sesión para acceder a contenido exclusivo");
    window.location.href = '../Login/index.html';
}
</script>
  <header>
    <h1>Plantasia</h1>
    <nav>
      <ul>
        <li><a href="../Home/index.html">Home</a></li>
        <li><a href="../Home/index.html#SobreNosotros">Nosotros</a></li>
        <li><a href="../Profile/index.html">Perfil</a></li>
      </ul>
    </nav>
  </header>

  <main>
    <section class="intro">
      <h2>México y el cuidado ambiental</h2>
      <p>
        México enfrenta una dualidad ambiental: por un lado, posee una de las biodiversidades más 
        ricas del mundo; por el otro, carga con una crisis ecológica derivada del crecimiento urbano 
        desordenado, la sobreexplotación de recursos y una gestión ambiental fragmentada. 
        En este contexto, la conciencia ambiental en México ya no es una opción, sino una responsabilidad 
        compartida entre instituciones, empresas y ciudadanía. Las generaciones jóvenes están asumiendo un 
        papel clave desde la innovación.
      </p>
      <div class="imagen-eco">
        <img src="https://img.freepik.com/vector-premium/bosquejo-tinta-arbol-pino-ilustracion-vector-dibujado-mano-dibujo-estilo-vintage_63088348.jpg" alt="Árbol estilo vectorial" />
      </div>
    </section>

    <section class="transition">
      <h3>Transición hacia una cultura de sostenibilidad</h3>
      <div class="text-columns">
        <p>
          En los últimos años, ha crecido el interés por hábitos sostenibles como el consumo responsable, 
          la movilidad ecológica y la reducción de residuos. Esta transición no se basa solo en el reciclaje 
          o en modas pasajeras, sino en rediseñar la relación entre las personas y su entorno. Una tendencia 
          que salve al mundo.
        </p>
        <p>
          Desde startups que crean empaques biodegradables hasta desarrollos inmobiliarios con enfoque 
          regenerativo, hay un giro claro hacia la sostenibilidad como un eje estratégico, no decorativo. 
          El cambio real ocurre cuando la sustentabilidad deja de ser una tendencia para convertirse en 
          infraestructura cultural.
        </p>
      </div>
    </section>

<section class="stats">
  <h3>Estados con más miembros Plantasísticos</h3>
  <div class="chart">
    <label for="estado">¿De qué estado eres?</label><br><br>
    <select id="estado" name="estado">
      <option value="" disabled selected>Selecciona tu estado</option>
      <option>Baja California</option>
      <option>Baja California Sur</option>
      <option>Campeche</option>
      <option>CDMX</option>
      <option>Chiapas</option>
      <option>Chihuahua</option>
      <option>Coahuila</option>
      <option>Colima</option>
      <option>Durango</option>
      <option>Estado de México</option>
      <option>Guanajuato</option>
      <option>Guerrero</option>
      <option>Hidalgo</option>
      <option>Jalisco</option>
      <option>Michoacán</option>
      <option>Morelos</option>
      <option>Nayarit</option>
      <option>Nuevo León</option>
      <option>Oaxaca</option>
      <option>Puebla</option>
      <option>Querétaro</option>
      <option>Quintana Roo</option>
      <option>San Luis Potosí</option>
      <option>Sinaloa</option>
      <option>Sonora</option>
      <option>Tabasco</option>
      <option>Tamaulipas</option>
      <option>Tlaxcala</option>
      <option>Veracruz</option>
      <option>Yucatán</option>
      <option>Zacatecas</option>
    </select>
    <br><br>
    <button id="enviarEstadoBtn" type="button">Enviar</button>
    <br><br>
    <canvas id="estadosChart" width="300" height="300"></canvas>
  </div>
</section>

    <section class="biodiversity">
      <h3>Biodiversidad amenazada</h3>
      <p>
        México alberga aproximadamente el 10% de la biodiversidad mundial, con especies únicas que van 
        desde el ajolote hasta el jaguar. Sin embargo, esta riqueza está bajo presión constante por la 
        deforestación, la contaminación de cuerpos de agua y la expansión agrícola y urbana no planificada.
        Cada año se pierden miles de hectáreas de ecosistemas estratégicos como selvas y manglares, 
        afectando no solo la fauna y flora, sino también los sistemas de vida de comunidades enteras. 
        La conservación ya no puede depender únicamente de políticas públicas; requiere nuevas narrativas 
        y soluciones tecnológicas aplicadas desde lo local.
      </p>
    </section>

    <section class="quiz">
  <h3>¿Podrías sobrevivir en un mundo 2°C más caliente?</h3>
  <div class="quiz-container">
    <div class="question">
      <p>¿Beberías agua recolectada de lluvia si fuera necesario?</p>
      <label><input type="radio" name="q1"> Sí</label>
      <label><input type="radio" name="q1"> No</label>
    </div>
    <div class="question">
      <p>¿Sobrevivirías sin internet si las redes caen por calor extremo?</p>
      <label><input type="radio" name="q2"> Sí</label>
      <label><input type="radio" name="q2"> No</label>
    </div>
    <div class="question">
      <p>¿Tienes plantas que purifiquen el aire en tu casa?</p>
      <label><input type="radio" name="q3"> Sí</label>
      <label><input type="radio" name="q3"> No</label>
    </div>
    <div class="question">
      <p>¿Podrías vivir sin carne si el planeta lo necesitara?</p>
      <label><input type="radio" name="q4"> Sí</label>
      <label><input type="radio" name="q4"> No</label>
    </div>
    <div class="question">
      <p>¿Te mudarías a una casa más pequeña y eficiente?</p>
      <label><input type="radio" name="q5"> Sí</label>
      <label><input type="radio" name="q5"> No</label>
    </div>
    <div class="question">
      <p>¿Aprenderías a cultivar tus propios alimentos?</p>
      <label><input type="radio" name="q6"> Sí</label>
      <label><input type="radio" name="q6"> No</label>
    </div>
    <div class="question">
      <p>¿Usarías ropa de segunda mano todo un año?</p>
      <label><input type="radio" name="q7"> Sí</label>
      <label><input type="radio" name="q7"> No</label>
    </div>
    <div class="question">
      <p>¿Estarías dispuesto a votar por políticas climáticas aunque impliquen más impuestos?</p>
      <label><input type="radio" name="q8"> Sí</label>
      <label><input type="radio" name="q8"> No</label>
    </div>
  </div>
  <div class="quiz-submit">
    <button type="button">Enviar</button>
  </div>
</section>

  </main>

 <footer>
  <div class="footer-content">
    <p>Plantasia</p>
    <p>Todos los derechos reservados</p>
    <p>© 2025 Plantasia</p>
  </div>
</footer>

<script>
// Si el usuario NO ha iniciado sesión, redirige al login
if (!localStorage.getItem('usuarioLogueado')) {
    window.location.href = '../Login/index.html';
}
</script>
<script>
function bloquearEstado(nombre_estado) {
    const select = document.getElementById('estado');
    const btn = document.getElementById('enviarEstadoBtn');
    if (nombre_estado) {
        select.value = nombre_estado;
        select.disabled = true;
        btn.textContent = 'Enviado';
        btn.disabled = true;
    } else {
        select.disabled = false;
        btn.textContent = 'Enviar';
        btn.disabled = false;
    }
}

// Al cargar la página, verifica si ya eligió estado
document.addEventListener('DOMContentLoaded', function() {
    const id_usuario = localStorage.getItem('id_usuario');
    if (!id_usuario) return;

    fetch(`http://localhost:8080/api/estado/${id_usuario}`)
        .then(res => res.json())
        .then(data => {
            if (data.exists) {
                bloquearEstado(data.nombre_estado);
            }
        });
});

document.getElementById('enviarEstadoBtn').addEventListener('click', function() {
    const estado = document.getElementById('estado').value;
    const id_usuario = localStorage.getItem('id_usuario');
    const btn = this;

    if (!estado) {
        alert('Selecciona tu estado');
        return;
    }
    if (!id_usuario) {
        alert('Debes iniciar sesión');
        window.location.href = '../Login/index.html';
        return;
    }

    fetch('http://localhost:8080/api/estado', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ id_usuario, nombre_estado: estado })
    })
    .then(res => res.json())
    .then(data => {
        if (data.success) {
            bloquearEstado(estado);
        } else {
            alert(data.message || 'Error al guardar estado');
        }
    })
    .catch(() => alert('Error de conexión con el servidor'));
});
</script>
<script>
let estadosChart;

function cargarGraficaEstados() {
    fetch('http://localhost:8080/api/estados/top')
        .then(res => res.json())
        .then(data => {
            const labels = data.map(e => e.nombre_estado);
            const values = data.map(e => parseInt(e.total));

            if (estadosChart) {
                estadosChart.data.labels = labels;
                estadosChart.data.datasets[0].data = values;
                estadosChart.update();
            } else {
                const ctx = document.getElementById('estadosChart').getContext('2d');
                estadosChart = new Chart(ctx, {
                    type: 'pie',
                    data: {
                        labels: labels,
                        datasets: [{
                            data: values,
                            backgroundColor: [
                                '#4CAF50', '#FFC107', '#2196F3', '#FF5722', '#9C27B0'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: { position: 'bottom' }
                        }
                    }
                });
            }
        });
}

// Carga la gráfica al cargar la página
document.addEventListener('DOMContentLoaded', cargarGraficaEstados);

// Actualiza la gráfica después de enviar el estado
document.getElementById('enviarEstadoBtn').addEventListener('click', function() {
    setTimeout(cargarGraficaEstados, 500); // Espera medio segundo para actualizar
});
</script>
<script>
function mostrarResultadoQuiz(resultado) {
    const quizSection = document.querySelector('.quiz');
    quizSection.innerHTML = `<h3>Resultado del Quiz</h3><div class="quiz-result">${resultado}</div>`;
}

function calcularResultado(respuestas) {
    const totalSi = respuestas.filter(Boolean).length;
    if (totalSi >= 6) {
        return "Líder de la Ecoaldea: Podrías dirigir comunidades sostenibles sin Wi-Fi.";
    } else if (totalSi > 4) {
        return "Sobreviviente con estilo: Te adaptarías bien, con flow ecológico.";
    } else {
        return "Climáticamente KO: Necesitas entrenar... o derretirte con el resto.";
    }
}

// Al cargar la página, verifica si ya hay respuestas guardadas
document.addEventListener('DOMContentLoaded', function() {
    const id_usuario = localStorage.getItem('id_usuario');
    if (!id_usuario) return;

    fetch(`http://localhost:8080/api/quiz/${id_usuario}`)
        .then(res => res.json())
        .then(data => {
            if (data.exists) {
                // Si ya respondió, muestra el resultado
                const respuestas = [
                    !!data.respuestas.pregunta_1,
                    !!data.respuestas.pregunta_2,
                    !!data.respuestas.pregunta_3,
                    !!data.respuestas.pregunta_4,
                    !!data.respuestas.pregunta_5,
                    !!data.respuestas.pregunta_6,
                    !!data.respuestas.pregunta_7,
                    !!data.respuestas.pregunta_8
                ];
                const resultado = calcularResultado(respuestas);
                mostrarResultadoQuiz(resultado);
            }
        });
});

// Al enviar el quiz
document.querySelector('.quiz-submit button').addEventListener('click', function() {
    const id_usuario = localStorage.getItem('id_usuario');
    if (!id_usuario) {
        alert('Debes iniciar sesión');
        window.location.href = '../Login/index.html';
        return;
    }
    // Obtén las respuestas (Sí = true/1, No = false/0)
    const respuestas = [];
    for (let i = 1; i <= 8; i++) {
        const radios = document.getElementsByName('q' + i);
        let valor = null;
        for (const radio of radios) {
            if (radio.checked) valor = radio.nextSibling.textContent.trim() === "Sí" ? 1 : 0;
        }
        if (valor === null) {
            alert('Responde todas las preguntas');
            return;
        }
        // Alternativamente, puedes usar: valor = radios[0].checked ? 1 : 0;
        respuestas.push(radios[0].checked ? 1 : 0);
    }

    fetch('http://localhost:8080/api/quiz', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ id_usuario, respuestas })
    })
    .then(res => res.json())
    .then(data => {
        if (data.success) {
            const resultado = calcularResultado(respuestas.map(v => !!v));
            mostrarResultadoQuiz(resultado);
        } else {
            alert(data.message || 'Error al guardar respuestas');
        }
    })
    .catch(() => alert('Error de conexión con el servidor'));
});
</script>

</body>
</html>
